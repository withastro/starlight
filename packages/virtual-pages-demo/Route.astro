---
import type { InferGetStaticPropsType } from 'astro';
import VirtualPage, {
	type VirtualPageProps,
} from '@astrojs/starlight/components/VirtualPage.astro';

import { getThings } from './things';
import heroStar from './hero-star.webp';

export function getStaticPaths() {
	return getThings().map((thing) => {
		const slug = `virtual-pages-demo/${thing}`;
		return {
			params: {
				// Generate the routes:
				//  - /virtual-pages-demo/a/
				//  - /virtual-pages-demo/b/
				//  - /virtual-pages-demo/c/
				//  - /virtual-pages-demo/d/
				//  - /virtual-pages-demo/e/
				virtualPagesDemoSlug: slug,
			},
			props: {
				// Pass down the generated slug and the thing to the page
				slug,
				thing,
			},
		};
	});
}

type Props = InferGetStaticPropsType<typeof getStaticPaths>;

const { slug, thing } = Astro.props;

// Generates the props for the virtual page
function getVirtualPageProps(): VirtualPageProps {
	const isThingB = thing === 'b';
	const isThingC = thing === 'c';
	const isThingD = thing === 'd';
	const isThingE = thing === 'e';

	const title = `Virtual Pages Demo: ${thing}`;

	if (isThingD) {
		// Page with minimal set of props.
		return { slug, title };
	} else if (isThingE) {
		// Page with the `splash` template, a hero including an image, an edit URL and a banner.
		return {
			banner: { content: 'This is a banner' },
			editUrl: 'https://starlight.astro.build/',
			hero: {
				title: 'Hello',
				tagline: 'This is a tagline',
				image: {
					alt: 'A star from a plugin',
					file: heroStar,
				},
			},
			slug,
			title,
		};
	}

	// Other pages with some other props modified for testing.
	const props: VirtualPageProps = {
		dir: isThingB ? 'rtl' : 'ltr',
		hasSidebar: !isThingB,
		lang: 'en',
		slug,
		tableOfContents: isThingC ? { maxHeadingLevel: 4, minHeadingLevel: 2 } : false,
		title,
	};

	if (isThingC) {
		props.headings = [
			{ depth: 2, slug: 'thing-a', text: 'Hello 2' },
			{ depth: 3, slug: 'thing-a', text: 'Hello 3' },
			{ depth: 4, slug: 'thing-a', text: 'Hello 4' },
		];
		props.sidebar = [
			{
				type: 'group',
				label: 'All the links',
				entries: [
					{
						type: 'link',
						label: 'Custom link 2',
						href: '/getting-started/',
						isCurrent: false,
						badge: { text: 'Wow', variant: 'danger' },
						attrs: {},
					},
				],
				collapsed: false,
				badge: undefined,
			},
		];
	}

	return props;
}
---

<VirtualPage {...getVirtualPageProps()}>
	<div>
		Some content from a plugin:
		{thing}
	</div>
</VirtualPage>
